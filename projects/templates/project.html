{% extends 'base.html' %}
{% load thumbnail %}

{% block content %}
    <section id="project" class="dashboard-profile-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
					<h2>{{project.title}}</h2>
					<p>{{project.description}}</p>
                    <div id=plot>
                    </div>
					<div class="col-lg-12 center">
						<a class="btn btn-primary page-scroll" href="/user/upload/{{project.id}}/">Upload I-V Data</a>
					</div><br />
					{% if cells %}
						<table class="tg">
						  <tr>
							<th class="tg-031e">Label</th>
							<th class="tg-031e">Efficiency (%)</th>
							<th class="tg-031e">Jsc</th>
							<th class="tg-031e">Voc</th>
							<th class="tg-031e">FF</th>
							<th class="tg-031e">Date</th>
							<th class="tg-031e">Data</th>
						  </tr>
						{% for cell in cells %}
						  <tr>
							  <td class="tg-4eph">{{cell.label}}</td>
							  <td class="tg-4eph">{{cell.eff}}</td>
							  <td class="tg-4eph">{{cell.jsc}}</td>
							  <td class="tg-4eph">{{cell.voc}}</td>
							  <td class="tg-4eph">{{cell.ff}}</td>
							  <td class="tg-4eph">{{cell.date}}</td>
							  <td class="tg-4eph"><a href="/media/{{cell.file}}">Download</a></td>
							  

						  </tr>
						{% endfor %}
						</table>		
					{% else %}
					    <p>No cells<p>
				    {% endif %}
                </div>
            </div>
		</div>
    </section>

    <style>
        .axis path,
        .axis line {
            fill: none;
            stroke: black;
            shape-rendering: crispEdges;
        }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
    <script>

        var dataset = {{data_json|safe }};
        console.log(dataset)

        var w = 900;
        var h = 500;
        var padding = 30;

        var parseDate = d3.time.format("%d %b %y").parse

        var svg = d3.select("#plot")
                    .append("svg")
                    .attr("width", w)
                    .attr("height", h);

        var xScale = d3.scale.linear()
    .range([padding, w - padding]);

        var yScale = d3.scale.linear()
                             .domain([0, d3.max(dataset, function(d) {return d[0]; })])
                             .range([h - padding, padding]);

        var xAxis = d3.svg.axis()
                          .scale(xScale)
                          .orient("bottom")
                          .ticks(5);

        var yAxis = d3.svg.axis()
                          .scale(yScale)
                          .orient("left")
                          .ticks(5);


        svg.selectAll("circle")
           .data(dataset)
           .enter()
           .append("circle")
           .attr("cx", function(d) {
                   return xScale(parseDate(d[4]));
           })
           .attr("cy", function(d) {
                   return yScale(d[0]);
           })
           .attr("r", 5);

        svg.append("g")
          .attr("class", "axis")
          .attr("transform", "translate(0," + (h - padding) + ")")
          .call(xAxis);

        svg.append("g")
           .attr("class", "axis")
           .attr("transform", "translate(" + padding + ",0)")
           .call(yAxis);

    </script>

{% endblock %}
