{% extends 'base.html' %}
{% load thumbnail %}

{% block content %}
    <section id="project" class="dashboard-profile-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h2>{{cell.label}}</h2>
                    <p>{{cell.notes}}</p>
                    <p>{{cell.file}}</p>
                    <div id=plot>
                    </div>
                    <div class="col-lg-12 center">
                        <a class="btn btn-primary page-scroll" href="/user/project/{{project.id}}/">Back to Project</a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <style>
        .axis path,
        .axis line {
            fill: none;
            stroke: black;
            shape-rendering: crispEdges;
        }

        .chart circle:hover{
            fill: red;
            stroke: #337ab7; 
            stroke-width: 4;
            cursor:pointer;
            r: 7;
        }

        .chart .label{
            font-weight: 400;
            font-size: 1em;
        }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
    <script>

        var w = 900;
        var h = 500;
        var padding = 30;

        var file = '/media/'+'{{cell.file}}';

        d3.text(file, 'text/csv', function(csv) {
            // remove comment rows with regex - not fully tested, but should work
            csv = csv.replace((/^[#@][^\r\n]+[\r\n]+/mg), '');
            // replace commas with spaces
            csv = csv.replace(/[ ,]+/g, ",");
            // parse data to array
            var dataset = d3.csv.parseRows(csv).map(function(row) {
                return row.map(function(value) {
                    return +value;
                });
            });
            console.log(dataset);

           var dataset = [
                  [ 5,     20 ],
                  [ 480,   90 ],
                  [ 250,   50 ],
                  [ 100,   33 ],
                  [ 330,   95 ],
                  [ 410,   12 ],
                  [ 475,   44 ],
                  [ 25,    67 ],
                  [ 85,    21 ],
                  [ 220,   88 ]
              ]; 

            var svg = d3.select("#plot")
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h)

            svg.selectAll("circle")
               .data(dataset)
               .enter()
               .append("circle")
               .attr("cx", function(d) { return d[0] })
               .attr("cy", function(d) { return d[1] })
               .attr("r", 5);
        });
    </script>

{% endblock %}
